<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Runtime,iOS开发,Swift,换肤," />










<meta name="description" content="导语：此前发表的关于APP换肤实现原理的文章——《APP动态换肤方案详解》受到了不少小伙伴的点赞与支持，但也有同学指出方案使用Objective-C语言来实现是不是已经有所过时，毕竟现在Apple开发的主流语言已经是Swift了。为此本人在基于原有换肤架构的基础下，重写了一套Swift版本的动态换肤方案——  CJSkinSwift 。   本文初次发表于OSCHINA   再谈APP换肤实现">
<meta property="og:type" content="article">
<meta property="og:title" content="再谈APP换肤实现">
<meta property="og:url" content="http://example.com/%E5%86%8D%E8%B0%88APP%E6%8D%A2%E8%82%A4%E5%AE%9E%E7%8E%B0/index.html">
<meta property="og:site_name" content="C.J.Lian">
<meta property="og:description" content="导语：此前发表的关于APP换肤实现原理的文章——《APP动态换肤方案详解》受到了不少小伙伴的点赞与支持，但也有同学指出方案使用Objective-C语言来实现是不是已经有所过时，毕竟现在Apple开发的主流语言已经是Swift了。为此本人在基于原有换肤架构的基础下，重写了一套Swift版本的动态换肤方案——  CJSkinSwift 。   本文初次发表于OSCHINA   再谈APP换肤实现">
<meta property="og:locale">
<meta property="og:image" content="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/%E6%8D%A2%E8%82%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%862.jpg">
<meta property="og:image" content="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/CJSkinSwift.png">
<meta property="og:image" content="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/skinZip.png">
<meta property="og:image" content="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/%E6%8D%A2%E8%82%A4%E6%9E%B6%E6%9E%84.jpg">
<meta property="og:image" content="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/CJSkinSwift%E6%B5%81%E7%A8%8B.jpg">
<meta property="article:published_time" content="2021-10-09T10:18:03.000Z">
<meta property="article:modified_time" content="2021-10-09T10:20:03.000Z">
<meta property="article:author" content="lele8446">
<meta property="article:tag" content="Runtime">
<meta property="article:tag" content="iOS开发">
<meta property="article:tag" content="Swift">
<meta property="article:tag" content="换肤">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/%E6%8D%A2%E8%82%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%862.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/再谈APP换肤实现/"/>





  <title>再谈APP换肤实现 | C.J.Lian</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">C.J.Lian</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">lele8446技术加油站</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/%E5%86%8D%E8%B0%88APP%E6%8D%A2%E8%82%A4%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C.J.Lian">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">再谈APP换肤实现</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-10-09T18:18:03+08:00">
                2021-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>导语：此前发表的关于APP换肤实现原理的文章——《<a target="_blank" rel="noopener" href="https://lele8446.top/2021/08/13/APP%E5%8A%A8%E6%80%81%E6%8D%A2%E8%82%A4%E6%96%B9%E6%A1%88%E8%AF%A6%E8%A7%A3/">APP动态换肤方案详解</a>》受到了不少小伙伴的点赞与支持，但也有同学指出方案使用Objective-C语言来实现是不是已经有所过时，毕竟现在Apple开发的主流语言已经是Swift了。为此本人在基于原有换肤架构的基础下，重写了一套Swift版本的动态换肤方案——  <a target="_blank" rel="noopener" href="https://github.com/lele8446/CJSkinSwift">CJSkinSwift</a> 。</p>
</blockquote>
<blockquote>
<p>本文初次发表于<a target="_blank" rel="noopener" href="https://www.oschina.net/"><strong>OSCHINA</strong> </a>  <a target="_blank" rel="noopener" href="https://my.oschina.net/u/5142693/blog/5270927">再谈APP换肤实现</a></p>
</blockquote>
<span id="more"></span>

<p><a target="_blank" rel="noopener" href="https://github.com/lele8446/CJSkinSwift">CJSkinSwift</a> 动态换肤方案主要介绍皮肤资源管理以及换肤实现两部分，其中皮肤资源管理用于说明动态换肤框架下皮肤资源的存储规则，换肤实现则介绍了换肤的底层实现以及换肤框架的使用方式。</p>
<h3 id="皮肤资源管理"><a href="#皮肤资源管理" class="headerlink" title="皮肤资源管理"></a>皮肤资源管理</h3><p>APP换肤的本质是界面样式在视觉层面上的变化，而构成样式布局的基本元素是：图片、字体、颜色，所以在构建换肤方案的过程中我们只需考虑以上三样资源的变换管理就可以了。当然你可能会说换肤应该还包括界面布局以及动画效果的改变，确实这是换肤中的重要一环，但它们其实是紧跟着产品走的，不同的APP会有不同的页面布局，你没法将其加入到换肤方案中作为通用功能来实现，所以不在本文的讨论范围内。</p>
<p>先来看一下换肤资源管理模块的总体架构图：</p>
<p><img src="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/%E6%8D%A2%E8%82%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%862.jpg" alt="换肤资源管理"></p>
<p>CJSkinSwift规定使用 <strong>CJSkin.plist</strong>（文件名固定）来配置管理换肤信息，CJSkin.plist实质上是一个xml文件，它里面用字典记录了不同皮肤包的资源信息。例如下图二所示：当前项目的CJSkin.plist文件内记录了default、skin1、skin2三个皮肤包，每个皮肤包内固定包含 <code>Color</code> 颜色、<code>Image</code> 图片、<code>Font</code> 字体三类皮肤元素的信息。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;default&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;Color&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;颜色1&quot;</span>: <span class="hljs-string">&quot;0x036EB7&quot;</span>,<br>      <span class="hljs-attr">&quot;颜色2&quot;</span>: <span class="hljs-string">&quot;0x025893&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;Image&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;图片1&quot;</span>: <span class="hljs-string">&quot;https://www.xxx/xxx.png&quot;</span>,<br>      <span class="hljs-attr">&quot;图片2&quot;</span>: <span class="hljs-string">&quot;icon.png&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;Font&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;字体1&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;Name&quot;</span>: <span class="hljs-string">&quot;Marker Felt&quot;</span>,<br>        <span class="hljs-attr">&quot;Size&quot;</span>: <span class="hljs-string">&quot;14&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/CJSkinSwift.png" alt="CJSkin.plist"></p>
<blockquote>
<p>注意：CJSkin.plist中 <strong>default</strong> 皮肤包名，资源key： <strong>Color</strong> 、<strong>Image</strong> 、<strong>Font</strong> 以及Font中的 <strong>Name</strong>、<strong>Size</strong> 这些key值的名称是固定的，配置时不能写错！</p>
</blockquote>
<h4 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h4><p>不同皮肤包 <strong>Color</strong> 字典中的key相同值不同：比如default皮肤包中 <code>导航背景色</code> 值为0x996666，skin2皮肤包中 <code>导航背景色</code> 的值为0x454545。</p>
<h4 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h4><p><strong>Image</strong> 的说明同理，比如default和skin2皮肤包都在CJSkin.plist中对图片 <code>top</code> 进行了配置说明，它们分别指向了不同的在线url；不同皮肤包的图片还可以放到各自的 <strong>.bundle</strong> 文件夹内，同时在CJSkin.plist中声明图片别名。比如skin1.bundle中包含图片 <code>top@2x.png、top@3x.png</code>，它在CJSkin.plist的配置为  <code>&#123;&quot;Image&quot;:&#123;&quot;top&quot;:&quot;top.png&quot;&#125;&#125; </code>，也可以CJSkin.plist中不做配置，而是在获取图片的时候key直接等于 <strong>skin1.bundle</strong>文件夹中存储的图片名 <strong>top</strong>。</p>
<h4 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h4><p><strong>Font</strong> 的配置说明也是一样，不同皮肤包的key相同，值为包含 <strong>Name、Size</strong> 两个固定key的字典，Name为空则使用系统默认字体，Size表示了字号大小。</p>
<h4 id="皮肤包更新"><a href="#皮肤包更新" class="headerlink" title="皮肤包更新"></a>皮肤包更新</h4><p>既然是动态换肤，那么换肤方案除了支持内置皮肤的更新之外，还应该具有在线皮肤包的动态更新。其中内置皮肤资源包的管理从前面图二可以看出，项目中必须包含 <strong>CJSkin.plist</strong> 文件以便用于所有内置皮肤包的配置说明，同时CJSkin.plist中默认包含 <strong>default</strong> 皮肤，这是不可缺失的默认皮肤包。各个皮肤包内有又分别对各自的 <strong>Color、Image、Font</strong> 进行配置说明，对于不同皮肤包下的图片资源，除了可以通过在CJSkin.plist中配置说明具体的在线url外，也可以统一放置到 <strong>XXX.bundle</strong> 文件夹内，而 <strong>XXX</strong> 则表示在CJSkin.plist中配置的皮肤包名，例如图二示例中的项目包含了 <code>default.bundle</code>、 <code>skin1.bundle</code>、 <code>skin2.bundle</code> 三个皮肤包的图片资源。另外 <strong>default.bundle</strong> 存储的是默认皮肤资源，你也可以不加入default.bundle而是把图片存储在 <strong>Assets.xcassets</strong> 中，但CJSkin.plist中 <strong>default</strong> 皮肤的配置说明不能缺失。</p>
<p>换肤方案在线皮肤包分为两种情况，一种是只更新 <strong>CJSkin.plist</strong> 对应皮肤配置说明，那么只需将新的皮肤数据按照CJSkin.plist规定的格式下发，APP再在请求数据后调用更新方法即可。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">/// 更新皮肤包配置信息</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateSkinPlistInfo</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">skinPlistInfo</span>: <span class="hljs-type">NSDictionary</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">completion</span>: <span class="hljs-type">CJSkinSwift</span>.<span class="hljs-type">SkinActionCompletion</span>?)</span><br></code></pre></td></tr></table></figure>

<p>另一种情况除了更新皮肤配置信息外，还包括更新皮肤包下的图片资源，此时则是使用下载皮肤压缩包 <strong>.zip</strong> 的形式进行更新。</p>
<p><img src="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/skinZip.png" alt="Example.zip"></p>
<p>皮肤包压缩资源示例说明：</p>
<ol>
<li>压缩包内必须包含 CJSkin.plist 皮肤配置说明文件， <strong>newSkin</strong> 文件夹表示新增皮肤包名称（新增皮肤包可以多个），其与CJSkin.plist处于同级文件目录下；</li>
<li>CJSkin.plist 文件内填写newSkin皮肤的配置信息，如果有多个皮肤则全部都要对应填写；</li>
<li>newSkin文件夹内放置该皮肤包的所有图片资源，如果图片有别名则在CJSkin.plist内配置说明；例如： <code>&#123;&quot;newSkin&quot;:&#123;&quot;Image&quot;:&#123;&quot;顶部图片&quot;:&quot;top&quot;&#125;&#125;&#125;</code>，对应的实际图片可以是 <code>top@2x.png、top@3x.png</code>，或者 <code>top.jpeg</code>；</li>
<li>将newSkin文件夹、CJSkin.plist文件放入新建文件夹（Example），并压缩为 <strong>Example.zip</strong>便是最终的皮肤包压缩资源。</li>
</ol>
<p>将 <strong>Example.zip</strong>部署到服务器后，直接调用下载更新方法便能够完成新增皮肤包的在线更新。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">/// 下载皮肤包压缩资源并自动解压更新</span><br><span class="hljs-comment">/// - Parameters:</span><br><span class="hljs-comment">///   - url: 压缩包资源下载地址</span><br><span class="hljs-comment">///   - completion: 结果回调</span><br><span class="hljs-comment">/// - Returns: Void</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">downloadSkinZip</span>(<span class="hljs-params">url</span>: <span class="hljs-type">String</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> <span class="hljs-type">CJSkinSwift</span>.<span class="hljs-type">SkinActionCompletion</span>)</span><br></code></pre></td></tr></table></figure>



<h3 id="换肤实现"><a href="#换肤实现" class="headerlink" title="换肤实现"></a>换肤实现</h3><p>看完前面对换肤资源管理模块的介绍，你可能已经猜到 <a target="_blank" rel="noopener" href="https://github.com/lele8446/CJSkinSwift">CJSkinSwift</a> 其实是约定了不同皮肤资源的存储方式，然后再在读取的时候通过key来映射获取当前皮肤包下的具体资源，从而完成换肤。</p>
<p><img src="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/%E6%8D%A2%E8%82%A4%E6%9E%B6%E6%9E%84.jpg" alt="换肤架构"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/lele8446/CJSkinSwift">CJSkinSwift</a> 中的 <strong>CJSkinTool</strong> 便是承担了换肤控制中心模块中对皮肤资源进行映射读取的职责，其中提供了对颜色、图片、字体资源的快捷读取方式。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">/// 快速获取当前皮肤包资源转换工具类</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SkinTool</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">key</span>: <span class="hljs-type">String</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">type</span>: <span class="hljs-type">CJSkinSwift</span>.<span class="hljs-type">CJSkinValueType</span>)</span> -&gt; <span class="hljs-type">CJSkinSwift</span>.<span class="hljs-type">CJSkinTool</span><br><br><span class="hljs-comment">/// 从当前皮肤包，快速获取颜色，可指定颜色透明度</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SkinColor</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">key</span>: <span class="hljs-type">String</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">alpha</span>: <span class="hljs-type">CGFloat</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>)</span> -&gt; <span class="hljs-type">UIColor</span><br><br><span class="hljs-comment">/// 从当前皮肤包，快速获取字体，可指定字体类型（只在字体样式为系统字体的情况下有效）</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SkinFont</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">key</span>: <span class="hljs-type">String</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">fontType</span>: <span class="hljs-type">CJSkinSwift</span>.<span class="hljs-type">CJSkinFontType</span> <span class="hljs-operator">=</span> .skinFontRegular)</span> -&gt; <span class="hljs-type">UIFont</span><br><br><span class="hljs-comment">/// 从当前皮肤包，快速获取图片</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SkinImage</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">key</span>: <span class="hljs-type">String</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">refreshSkinTarget</span>: <span class="hljs-type">NSObject</span>?)</span> -&gt; <span class="hljs-type">UIImage</span><br></code></pre></td></tr></table></figure>

<p>此处需要对图片资源的读取 <strong>SkinImage()</strong> 另外说明一下，由于图片资源比较特殊，它可能会存在三种存储方式。</p>
<ul>
<li>一是CJSkin.plist中配置的在线url图片，此时使用 <code>SkinImage(_ key: String, _ refreshSkinTarget: NSObject?)</code> 获取图片，如果图片还未下载成功返回的将会是 <strong>UIImage.init()</strong> 空白图片，你可使用CJSkinTool 的 asyncGetSkinImage方法异步下载图片；也可以通过在 <strong>refreshSkin{}</strong> 中获取图片并指定refreshSkinTarget，这样当图片异步下载完成后将会自动调用refreshSkin()重刷图片。</li>
</ul>
 <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs swift">imageView.refreshSkin <span class="hljs-operator">=</span> &#123; (weakSelf: <span class="hljs-type">NSObject</span>) <span class="hljs-keyword">in</span><br>   (weakSelf <span class="hljs-keyword">as!</span> <span class="hljs-type">UIImageView</span>).image <span class="hljs-operator">=</span> <span class="hljs-type">SkinImage</span>(<span class="hljs-string">&quot;top&quot;</span>, weakSelf)<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>二是开发阶段直接内置存储在 <strong>XXX.bundle</strong> 中的皮肤图片，由于图片在指定bundle中，这种情况下是无法只是指定图片名 <code>UIImage.init(named: &quot;name&quot;)</code> 来获取图片的，而必须声明具体的图片路径 <code>UIImage.init(named: &quot;xxx.bundle/name&quot;)</code>，<strong>SkinImage()</strong> 方法已经对此进行了封装处理。 </p>
</li>
<li><p>三是以skin.zip的形式整体下载的皮肤压缩包资源，当 <code>downloadSkinZip()</code> 下载更新完成后，对应的皮肤图片资源将存储在沙盒中，此时获取图片涉及到了NSData与UIImage的转换，<strong>SkinImage()</strong> 方法也已经对此进行了封装处理。</p>
</li>
</ul>
<h4 id="静态换肤"><a href="#静态换肤" class="headerlink" title="静态换肤"></a>静态换肤</h4><p>静态换肤是指UI组件能够根据当前皮肤主题显示对应的样式，但当APP发生皮肤切换事件后，UI组件和所在页面不会自动刷新样式，只能重新设置或者页面重载才可更新换肤。实际开发中可以根据实际情况，对不是常驻存留的页面（一般都是次级之后的页面）使用静态换肤，使用方式也非常简单，直接获取资源赋值即可。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">let</span> button <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>.<span class="hljs-keyword">init</span>()<br><span class="hljs-comment">//设置颜色</span><br>button.backgroundColor <span class="hljs-operator">=</span> <span class="hljs-type">SkinColor</span>(<span class="hljs-string">&quot;背景色&quot;</span>)<br><span class="hljs-comment">//设置图片</span><br>button.setImage(<span class="hljs-type">SkinImage</span>(<span class="hljs-string">&quot;按钮&quot;</span>, <span class="hljs-literal">nil</span>), for: .normal)<br><span class="hljs-comment">//设置字体</span><br>button.titleLabel<span class="hljs-operator">?</span>.font <span class="hljs-operator">=</span> <span class="hljs-type">SkinFont</span>(<span class="hljs-string">&quot;标题&quot;</span>)<br></code></pre></td></tr></table></figure>

<h4 id="动态换肤"><a href="#动态换肤" class="headerlink" title="动态换肤"></a>动态换肤</h4><p>与静态换肤对应的是动态换肤，动态换肤主要针对的是常驻存留页面，比如UITabBarController上的主页，它们的生命周期是跟随着APP的生命周期走的，只要APP不被重启或主动重绘那就不存在页面重刷。因此当换肤事件发生时，这些页面上的样式元素就需要具备主动监听换肤事件并自动重刷UI的能力，否则换肤后APP必须重启才能生效这将使得使用体验大打折扣。</p>
<p>在《<a target="_blank" rel="noopener" href="https://lele8446.top/2021/08/13/APP%E5%8A%A8%E6%80%81%E6%8D%A2%E8%82%A4%E6%96%B9%E6%A1%88%E8%AF%A6%E8%A7%A3/">APP动态换肤方案详解</a>》关于 <a target="_blank" rel="noopener" href="https://github.com/lele8446/CJSkin">CJSkin</a> 换肤方案的介绍中，由于CJSkin使用的Objective-C语言具有运行时Runtime的特性，我们可以使用Runtime + 消息转发来实现动态换肤。但是 <a target="_blank" rel="noopener" href="https://github.com/lele8446/CJSkinSwift">CJSkinSwift</a> 是Swift版本的，纯Swift并没有Runtime机制，当然Swift也可以混编Objective-C从而借助OC的运行时特性来达成目的，但总感觉这种方案太过笨重，这里换了一种更加取巧的实现思路。</p>
<p>在 <strong>NSObject</strong> 的分类中增加扩展属性 <strong><code>refreshSkin</code></strong> 。 <strong><code>refreshSkin</code></strong> 是一个闭包，当对refreshSkin闭包赋值的同时完成当前对象对换肤通知事件的监听，使用的时候我们在闭包代码块内进行静态换肤样式的设置。当换肤事件发生时，所有接收到换肤通知的实例对象将会自动重新执行 <strong><code>refreshSkin</code></strong> 代码块从而达到动态换肤的效果。而且由于这是 <strong>NSObject</strong> 的分类，也就意味着除了可以对UIView系列的UI组件进行换肤事件的监听外，其他任意类的实例对象都可以进行换肤设置，这大大增加了换肤框架使用的灵活性。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">/// 设置换肤UI刷新</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">typealias</span> <span class="hljs-type">SkinUISetUpBlock</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">_</span> weakSelf: <span class="hljs-type">NSObject</span>)-&gt;<span class="hljs-type">Void</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">NSObject</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> addUISetUPNotification: <span class="hljs-type">Bool</span>! &#123;<br>        <span class="hljs-keyword">get</span> &#123;<br>            <span class="hljs-keyword">let</span> addNotification <span class="hljs-operator">=</span> objc_getAssociatedObject(<span class="hljs-keyword">self</span>, <span class="hljs-operator">&amp;</span><span class="hljs-type">SkinUISetUpAddNotificationKey</span>) <span class="hljs-operator">??</span> <span class="hljs-literal">false</span><br>            <span class="hljs-keyword">return</span> (addNotification <span class="hljs-keyword">as!</span> <span class="hljs-type">Bool</span>)<br>        &#125;<br>        <span class="hljs-keyword">set</span> &#123;<br>            objc_setAssociatedObject(<span class="hljs-keyword">self</span>, <span class="hljs-operator">&amp;</span><span class="hljs-type">SkinUISetUpAddNotificationKey</span>, newValue, .<span class="hljs-type">OBJC_ASSOCIATION_ASSIGN</span>)<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">/// 设置换肤UI刷新</span><br>    <span class="hljs-keyword">var</span> refreshSkin: <span class="hljs-type">SkinUISetUpBlock</span> &#123;<br>        <span class="hljs-keyword">get</span> &#123;<br>            <span class="hljs-keyword">var</span> setUp: <span class="hljs-type">SkinUISetUpBlock</span>?<br>            <span class="hljs-keyword">if</span> objc_getAssociatedObject(<span class="hljs-keyword">self</span>, <span class="hljs-operator">&amp;</span><span class="hljs-type">SkinUISetUpKey</span>) <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span> &#123;<br>                setUp <span class="hljs-operator">=</span> objc_getAssociatedObject(<span class="hljs-keyword">self</span>, <span class="hljs-operator">&amp;</span><span class="hljs-type">SkinUISetUpKey</span>) <span class="hljs-keyword">as?</span> <span class="hljs-type">SkinUISetUpBlock</span><br>            &#125;<br>            <span class="hljs-keyword">return</span> setUp<span class="hljs-operator">!</span><br>        &#125;<br>        <span class="hljs-keyword">set</span> &#123;<br>            objc_setAssociatedObject(<span class="hljs-keyword">self</span>, <span class="hljs-operator">&amp;</span><span class="hljs-type">SkinUISetUpKey</span>, newValue, .<span class="hljs-type">OBJC_ASSOCIATION_COPY</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-literal">false</span> <span class="hljs-operator">==</span> <span class="hljs-keyword">self</span>.addUISetUPNotification &#123;<br>                <span class="hljs-comment">// iOS9.0之后，使用 addObserver(_:selector:name:object:) 方式注册的通知，无需再在dealloc/deinit方法中主动移除通知观察者了</span><br>                <span class="hljs-comment">//详情见https://developer.apple.com/documentation/foundation/notificationcenter/1413994-removeobserver</span><br>                <span class="hljs-type">NotificationCenter</span>.default.addObserver(<span class="hljs-keyword">self</span>, selector: #selector(changeSkin), name: <span class="hljs-type">Notification</span>.<span class="hljs-type">Name</span>(<span class="hljs-type">CJSkinUpdateNotification</span>), object: <span class="hljs-literal">nil</span>)<br>                <span class="hljs-keyword">self</span>.addUISetUPNotification <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>            &#125;<br>            changeSkin()<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">changeSkin</span>()</span>&#123;<br>        <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> weakSelf <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span><br>        <span class="hljs-keyword">self</span>.refreshSkin(weakSelf<span class="hljs-operator">!</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>下面是动态换肤的使用示例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">let</span> button <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>.<span class="hljs-keyword">init</span>()<br>button.refreshSkin <span class="hljs-operator">=</span> &#123; (weakSelf: <span class="hljs-type">NSObject</span>) <span class="hljs-keyword">in</span><br>    <span class="hljs-keyword">let</span> wSelf <span class="hljs-operator">=</span> (weakSelf <span class="hljs-keyword">as!</span> <span class="hljs-type">UIButton</span>)<br>    wSelf.backgroundColor <span class="hljs-operator">=</span> <span class="hljs-type">SkinColor</span>(<span class="hljs-string">&quot;背景色&quot;</span>)<br>    wSelf.titleLabel<span class="hljs-operator">?</span>.font <span class="hljs-operator">=</span> <span class="hljs-type">SkinFont</span>(<span class="hljs-string">&quot;标题&quot;</span>)<br>    <span class="hljs-comment">//设置图片的渲染模式为展示原图；并且设置afterDownloadRefreshSkinTarget=wSelf，使得在线图片“按钮”、“按钮高亮”下载完成后将回调refreshSkin()进行UI换肤</span><br>    wSelf.setImage(<span class="hljs-type">SkinImageRenderingMode</span>(<span class="hljs-string">&quot;按钮&quot;</span>, .alwaysOriginal, wSelf), for: .normal)<br>    wSelf.setImage(<span class="hljs-type">SkinImageRenderingMode</span>(<span class="hljs-string">&quot;按钮高亮&quot;</span>, .alwaysOriginal, wSelf), for: .highlighted)<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>提示：其实在《<a target="_blank" rel="noopener" href="https://lele8446.top/2021/08/13/APP%E5%8A%A8%E6%80%81%E6%8D%A2%E8%82%A4%E6%96%B9%E6%A1%88%E8%AF%A6%E8%A7%A3/">APP动态换肤方案详解</a>》篇关于 <a target="_blank" rel="noopener" href="https://github.com/lele8446/CJSkin">CJSkin</a> 的换肤方案中也已经实现了该方案，调用方式是 <code>button.skinChangeBlock = ^(UIButton *weakSelf) &#123;&#125;</code>。</p>
</blockquote>
<h3 id="换肤流程"><a href="#换肤流程" class="headerlink" title="换肤流程"></a>换肤流程</h3><p>最后上一张CJSkinSwift换肤方案的流程图，更多详情请查看 <a target="_blank" rel="noopener" href="https://github.com/lele8446/CJSkinSwift">CJSkinSwift</a>。</p>
<p>如果你有更好的想法，欢迎留言交流！</p>
<p><img src="https://lele8446infoq.oss-cn-shenzhen.aliyuncs.com/cjskin/CJSkinSwift%E6%B5%81%E7%A8%8B.jpg" alt="换肤流程"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Runtime/" rel="tag"># Runtime</a>
          
            <a href="/tags/iOS%E5%BC%80%E5%8F%91/" rel="tag"># iOS开发</a>
          
            <a href="/tags/Swift/" rel="tag"># Swift</a>
          
            <a href="/tags/%E6%8D%A2%E8%82%A4/" rel="tag"># 换肤</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/APP%E5%8A%A8%E6%80%81%E6%8D%A2%E8%82%A4%E6%96%B9%E6%A1%88%E8%AF%A6%E8%A7%A3/" rel="next" title="APP动态换肤方案详解">
                <i class="fa fa-chevron-left"></i> APP动态换肤方案详解
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/lele8446" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-fab fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/a97f1b616991" target="_blank" title="简书">
                      
                        <i class="fa fa-fw fa-fab fa-book"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:lele8446@foxmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-fab fa-envelope"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.linkedin.com/in/%E7%82%BD%E9%87%91-%E7%BB%83-966a4813b/" target="_blank" title="Linkedin">
                      
                        <i class="fa fa-fw fa-fab fa-linkedin"></i></a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9A%AE%E8%82%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">皮肤资源管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%9C%E8%89%B2"><span class="nav-number">1.1.</span> <span class="nav-text">颜色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%BE%E7%89%87"><span class="nav-number">1.2.</span> <span class="nav-text">图片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E4%BD%93"><span class="nav-number">1.3.</span> <span class="nav-text">字体</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9A%AE%E8%82%A4%E5%8C%85%E6%9B%B4%E6%96%B0"><span class="nav-number">1.4.</span> <span class="nav-text">皮肤包更新</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8D%A2%E8%82%A4%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.</span> <span class="nav-text">换肤实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E6%8D%A2%E8%82%A4"><span class="nav-number">2.1.</span> <span class="nav-text">静态换肤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%8D%A2%E8%82%A4"><span class="nav-number">2.2.</span> <span class="nav-text">动态换肤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8D%A2%E8%82%A4%E6%B5%81%E7%A8%8B"><span class="nav-number">3.</span> <span class="nav-text">换肤流程</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ChiJin.Lian  粤ICP备2022055361号</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
